---
title: 前端性能优化之网络负载
date: 2025-04-26 23:28:08
updated:
category: ['技术']
tags: ['前端','性能优化','网络负载']
cover: https://s1.imagehub.cc/images/2025/04/26/59a811e71f3f9e747ff98f2555a10a41.md.jpg
main_color: "#0157E8"
keywords:
description:
top_img:
comments:
aside:
---

# 网络优化

**配置优化：**通过调整构建工具（如`Webpack`或`Vite`）的配置，比如代码压缩、`Tree Shaking`和代码分割，减少打包体积和加载时间。

**访问优化：**包括图片懒加载、预加载关键资源，以及优化`DOM`操作，减少渲染阻塞，提升用户体验。

通过减少`HTTP`请求、启用`HTTP/2`、使用`CDN`和缓存策略，提升资源加载速度。

避免巨大的网络负载是`Lighthouse`的一个审计指标，它指的是**前端文件通过网络传输的总大小**。

需要实施一个全面的`Web`性能优化流程：识别特定问题、可视化`HTML`和`CSS`文件、压缩和精简代码、减小字体和图片的体积等。

**网络负载**是指页面从自身服务器或第三方服务器通过互联网下载的所有文件的总和。

## 优化网络负载

需要减少资源的总大小：

1. **移除不必要的资源**
    - 找出那些对用户体验没有显著影响的资源，并将它们从页面中移除。
    - 未使用的`CSS`和`JavaScript`文件、过大的图片等
2. **减小资源的下载大小**
    - 使用压缩工具（如`Gzip`或`Brotli`）压缩`HTML`、`CSS`和`JavaScript`文件。
    - 优化图片和字体大小，采用现代格式（如`webP`和`woff2`）。
3. **延迟加载资源（Lazy Loading）**
    - 仅在用户需要某些资源时才进行下载。
    - 使用`loading="lazy"`属性为图片和`iframe`添加懒加载。

**Lighthouse记录的是页面初始加载时的网络负载。**这意味着报告显示的资源大小是页面首次加载时所有请求的总和。

根据`Lighthouse`的文档，当网络负载满足以下条件时，就会被认为是“巨大”：

> 根据`HTTP Archive`的数据，网络负载的中位数在`1700`到`1900``KiB`之间。为了突出最重的网络负载，`Lighthouse`会标记那些总网络请求超过`5000``KiB`的页面。

1. **黄色警告标志的触发条件**
    - 当网络负载超过`2667KB`时，`Lighthouse`会触发黄色警告标志（`yellow flag`）。
    - 低于这个值，则显示灰色信息标志（`grey flag`），表示通过。
2. **永远没有绿色标志**
3. **没有红色标志**
    - 即使网络负载非常高，`Lighthouse`也不会触发红色标志（`red flag`）。它只会显示黄色标志，提示需要优化。

1. **灰色标志**：表示通过审计，但仅限于网络负载低于`2667KB`的情况。
2. **黄色标志**：表示未通过审计，网络负载超过`2667KB`。
3. **红色标志**：不会触发，即使网络负载非常高。

- **灰色标志=成功**：网络负载低于`2667KB`。
- **黄色标志=失败**：网络负载高于`2667KB`。

因此，优化目标是让网络负载尽可能小，以达到灰色标志的标准。

巨大的网络负载会对`Web`性能产生严重影响，不仅会导致页面加载变慢，有时还会引发意外的布局偏移问题。

1. **对核心Web指标的影响**

巨大的网络负载可能会增加以下三个**核心Web指标**的得分，从而降低用户体验：

- **最大内容渲染时间（`Largest Contentful Paint, LCP`）**
当网络负载较重时，关键内容（如首屏内容）需要更长时间才能出现在屏幕上，直接导致`LCP`得分变差。

- **交互到下一次渲染时间（`Interaction to Next Paint，INP`）**
`JavaScript`文件下载和编译速度变慢，会拖延交互反馈时间，影响用户的操作流畅性。

- **累计布局偏移（`Cumulative Layout Shift，CLS`）**
如果浏览器需要下载并处理更多文件，不同的布局元素可能会以非线性的顺序出现，导致更多的意外布局偏移。

## 分析网络负载

1. 使用`Lighthouse`报告
`Lighthouse`的`Avoid Enormous Network Payloads`审计可以快速判断你的页面是否通过了网络负载的审计，并提供网络负载的整体结构概览。
2. 使用高级性能分析工具
- **资源的请求瀑布图（`Request Waterfall`）**

**解读瀑布图**
- 每个资源的大小
- 加载优先级
- 加载持续时间
- 加载顺序

**通过分析这些信息，你可以**
- 找到不必要的资源，考虑移除
- 针对某些资源进行重构或替换
- 将低优先级资源推迟加载（如图片、非关键`CSS`和`JS`）

3. **`DebugBear`的功能亮点**
- **资源排序**：根据请求的优先级、持续时间、大小和下载顺序对资源进行排序。
- **域名分析**：查看浏览器连接的所有第三方域名。
- **资源过滤**：按文件类型（`HTML`、`CSS`、脚本、图片、字体等）过滤资源，快速定位目标资源。
- **`HTTP`请求细节检查**：
    - 请求头和响应头
    - 请求体内容
    - 请求链（`Request Chain`）

4. **优化思路**
- **移除不必要的资源**：检查哪些资源是可以完全去掉的。
- **推迟加载非关键资源**：如懒加载图片和脚本
- **合并或精简资源**：减少资源的体积和数量
- **优化第三方资源**：检查是否有过多的第三方请求，优先优化它们

## 减少`HTML`文件的下载大小

**如何判断`HTML`文件是否过大？**
- 使用`Lighthouse`或`DebugBear`的审计功能，检查文件是否超标（通常基于压缩后的体积）。
- 分析文件中的具体问题：
    - **内联样式**：过多的`<style>`块
    - **内联脚本**：嵌入过多的`<script>`内容

**优化方法**
1. **分离内联内容**
- 将内联的样式和脚本移至外部文件
2. **启用`HTTP`压缩**
- 在服务器端启用`Gzip`或`Brotli`压缩，进一步减小传输体积。
3. **删除无用内容**
- 检查冗余注释、多余空格和不必要的`meta`标签，减小文件大小。

## 避免过大的`CSS`文件

1. **冗长的选择器**
    - 复杂的`CSS`选择器增加文件体积
2. **未使用的样式规则**
    - 项目中未被使用的`CSS`代码
3. **`Base64`编码的嵌入资源**
    - 内嵌的图片或字体会显著增加文件体积，可将它们替换为外部文件
4. **过长的变量名**
    - 变量命令过长会累积大量不必要的字节数
      
**优化方法**

1. **清理未使用的样式**
    - 使用工具如`PurifyCSS`或`UNCSS`检测和移除未被引用的规则。
2. 压缩`CSS`文件
    - 借助`cssnano`或`PostCSS`删除多余空格、注释等内容。
3. **分割与按需加载**
    - 通过代码分割技术，将`CSS`文件拆分为仅需加载的部分。
4. **优化变量命名**
    - 将过长的变量名替换为更简短的名称。

## 压缩文本文件